<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>thetis.stability_functions &#8212; Thetis 0+untagged.2082.gf1a0bbb documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/thetis.css?v=0f3339d6" />
    <script src="../../_static/documentation_options.js?v=ccd1159c"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

<!-- <link rel="stylesheet" href="../../_static/featured.css"> -->


<link rel="shortcut icon" href="../../_static/icon_thetis.ico" />


  </head><body>
<div class="wrapper">
  <a href="../../index.html"><img src="../../_static/banner.jpg" height="180px" alt="Thetis Project Banner" /></a>
  <div id="access">
    <div class="menu">
      <ul>
        <li class="page_item"><a href="../../documentation.html" title="Thetis documentation">Documentation</a></li>
        <li class="page_item"><a href="../../download.html" title="Install Thetis">Download</a></li>
        <li class="page_item"><a href="../../team.html" title="Development team">Team</a></li>
        <li class="page_item"><a href="../../publications.html" title="Publications">Publications</a></li>
        <li class="page_item"><a href="../../funding.html" title="Our financial supporters">Funding</a></li>
        <li class="page_item"><a href="../../contact.html" title="Getting in touch">Contact</a></li>
        <li class="page_item"><a href="https://github.com/thetisproject/thetis" title="Thetis source on GitHub">GitHub</a></li>
      </ul>
    </div><!-- .menu -->
  </div><!-- #access -->
</div><!-- #wrapper -->


    <div class="document">
    <div class="_modules/thetis/stability_functions">
      
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for thetis.stability_functions</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Implements turbulence closure model stability functions.</span>

<span class="sd">.. math::</span>
<span class="sd">    S_m &amp;= S_m(\alpha_M, \alpha_N) \\</span>
<span class="sd">    S_\rho &amp;= S_\rho(\alpha_M, \alpha_N)</span>

<span class="sd">where :math:`\alpha_M, \alpha_N` are the normalized shear and buoyancy frequency</span>

<span class="sd">    .. math::</span>
<span class="sd">        \alpha_M &amp;= \frac{k^2}{\varepsilon^2} M^2 \\</span>
<span class="sd">        \alpha_N &amp;= \frac{k^2}{\varepsilon^2} N^2</span>

<span class="sd">The following stability functions have been implemented</span>

<span class="sd">- Canuto A</span>
<span class="sd">- Canuto B</span>
<span class="sd">- Kantha-Clayson</span>
<span class="sd">- Cheng</span>

<span class="sd">References:</span>

<span class="sd">Umlauf, L. and Burchard, H. (2005). Second-order turbulence closure models</span>
<span class="sd">for geophysical boundary layers. A review of recent work. Continental Shelf</span>
<span class="sd">Research, 25(7-8):795--827. http://dx.doi.org/10.1016/j.csr.2004.08.004</span>

<span class="sd">Burchard, H. and Bolding, K. (2001). Comparative Analysis of Four</span>
<span class="sd">Second-Moment Turbulence Closure Models for the Oceanic Mixed Layer. Journal of</span>
<span class="sd">Physical Oceanography, 31(8):1943--1968.</span>
<span class="sd">http://dx.doi.org/10.1175/1520-0485(2001)031</span>

<span class="sd">Umlauf, L. and Burchard, H. (2003). A generic length-scale equation for</span>
<span class="sd">geophysical turbulence models. Journal of Marine Research, 61:235--265(31).</span>
<span class="sd">http://dx.doi.org/10.1357/002224003322005087</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.log</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_output</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;StabilityFunctionBase&#39;</span><span class="p">,</span>
    <span class="s1">&#39;StabilityFunctionCanutoA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;StabilityFunctionCanutoB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;StabilityFunctionCheng&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GOTMStabilityFunctionCanutoA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GOTMStabilityFunctionCanutoB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GOTMStabilityFunctionCheng&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GOTMStabilityFunctionKanthaClayson&#39;</span><span class="p">,</span>
    <span class="s1">&#39;compute_normalized_frequencies&#39;</span>
<span class="p">]</span>


<div class="viewcode-block" id="compute_normalized_frequencies">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.compute_normalized_frequencies">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_normalized_frequencies</span><span class="p">(</span><span class="n">shear2</span><span class="p">,</span> <span class="n">buoy2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes normalized buoyancy and shear frequency squared.</span>

<span class="sd">    .. math::</span>
<span class="sd">        \alpha_M &amp;= \frac{k^2}{\varepsilon^2} M^2 \\</span>
<span class="sd">        \alpha_N &amp;= \frac{k^2}{\varepsilon^2} N^2</span>

<span class="sd">    From Burchard and Bolding (2001).</span>

<span class="sd">    :arg shear2: :math:`M^2`</span>
<span class="sd">    :arg buoy2: :math:`N^2`</span>
<span class="sd">    :arg k: turbulent kinetic energy</span>
<span class="sd">    :arg eps: TKE dissipation rate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">alpha_buoy</span> <span class="o">=</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">eps</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">buoy2</span>
    <span class="n">alpha_shear</span> <span class="o">=</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">eps</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">shear2</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">print_output</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:8s}</span><span class="s1"> </span><span class="si">{:8.3e}</span><span class="s1"> </span><span class="si">{:8.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="n">shear2</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">shear2</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="n">print_output</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:8s}</span><span class="s1"> </span><span class="si">{:8.3e}</span><span class="s1"> </span><span class="si">{:8.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;N2&#39;</span><span class="p">,</span> <span class="n">buoy2</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">buoy2</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="n">print_output</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:8s}</span><span class="s1"> </span><span class="si">{:10.3e}</span><span class="s1"> </span><span class="si">{:10.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;a_buoy&#39;</span><span class="p">,</span> <span class="n">alpha_buoy</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">alpha_buoy</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="n">print_output</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:8s}</span><span class="s1"> </span><span class="si">{:10.3e}</span><span class="s1"> </span><span class="si">{:10.3e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;a_shear&#39;</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">alpha_shear</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span></div>



<div class="viewcode-block" id="StabilityFunctionBase">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StabilityFunctionBase</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all stability functions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lim_alpha_shear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lim_alpha_buoy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">smooth_alpha_buoy_lim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha_buoy_crit</span><span class="o">=-</span><span class="mf">1.2</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :kwarg bool lim_alpha_shear: limit maximum :math:`\alpha_M` values</span>
<span class="sd">            (see Umlauf and Burchard (2005) eq. 44)</span>
<span class="sd">        :kwarg bool lim_alpha_buoy: limit minimum (negative) :math:`\alpha_N` values</span>
<span class="sd">            (see Umlauf and Burchard (2005))</span>
<span class="sd">        :kwarg bool smooth_alpha_buoy_lim: if :math:`\alpha_N` is limited, apply a</span>
<span class="sd">            smooth limiter (see Burchard and Bolding (2001) eq. 19). Otherwise</span>
<span class="sd">            :math:`\alpha_N` is clipped at minimum value.</span>
<span class="sd">        :kwarg float alpha_buoy_crit: parameter for :math:`\alpha_N` smooth limiter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lim_alpha_shear</span> <span class="o">=</span> <span class="n">lim_alpha_shear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lim_alpha_buoy</span> <span class="o">=</span> <span class="n">lim_alpha_buoy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_alpha_buoy_lim</span> <span class="o">=</span> <span class="n">smooth_alpha_buoy_lim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_buoy_crit</span> <span class="o">=</span> <span class="n">alpha_buoy_crit</span>
        <span class="c1"># for plotting and such</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lim_alpha_shear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">,</span> <span class="s1">&#39;shear&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lim_alpha_buoy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;lim&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_alpha_buoy_lim</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;smooth&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;ac&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_buoy_crit</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

        <span class="c1"># denominator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d0</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d3</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d4</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d5</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># c_mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># c_mu_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb2</span> <span class="o">=</span> <span class="mf">0.0</span>

<div class="viewcode-block" id="StabilityFunctionBase.compute_alpha_shear_steady">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.compute_alpha_shear_steady">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_alpha_shear_steady</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ri_st</span><span class="p">,</span> <span class="n">analytical</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the steady-state :math:`\alpha_M`.</span>

<span class="sd">        Under steady-state conditions, the stability functions satisfy:</span>

<span class="sd">        .. math::</span>
<span class="sd">            S_m \alpha_M - S_\rho \alpha_M Ri_{st} = 1.0</span>

<span class="sd">        (Umlauf and Buchard, 2005, eq A.15) from which :math:`\alpha_M` can be</span>
<span class="sd">        solved for given gradient Richardson number :math:`Ri_{st}`.</span>

<span class="sd">        :arg float ri_st: Gradient Richardson number</span>
<span class="sd">        :kwarg bool analytical: If True (default), solve analytically using the</span>
<span class="sd">            coefficients of the stability function. Otherwise, solve</span>
<span class="sd">            :math:`\alpha_M` numerically from the equilibrium condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">analytical</span><span class="p">:</span>
            <span class="c1"># A) solve numerically</span>
            <span class="c1"># use equilibrium equation (Umlauf and Buchard, 2005, eq A.15)</span>
            <span class="c1"># s_m*a_shear - s_h*a_shear*ri_st = 1.0</span>
            <span class="c1"># to solve a_shear at equilibrium</span>
            <span class="c1"># NOTE may fail/return incorrect solution for ri_st &lt; -4</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">cost</span><span class="p">(</span><span class="n">a_shear</span><span class="p">):</span>
                <span class="n">a_buoy</span> <span class="o">=</span> <span class="n">ri_st</span><span class="o">*</span><span class="n">a_shear</span>
                <span class="n">s_m</span><span class="p">,</span> <span class="n">s_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_funcs</span><span class="p">(</span><span class="n">a_buoy</span><span class="p">,</span> <span class="n">a_shear</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">s_m</span><span class="o">*</span><span class="n">a_shear</span> <span class="o">-</span> <span class="n">s_h</span><span class="o">*</span><span class="n">a_buoy</span> <span class="o">-</span> <span class="mf">1.0</span>
                <span class="k">return</span> <span class="n">res</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="s1">&#39;solving alpha_shear failed, Ri_st=</span><span class="si">{:}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ri_st</span><span class="p">)</span>
            <span class="n">a_shear</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># B) solve analytically</span>
            <span class="c1"># compute alpha_shear for equilibrium condition (Umlauf and Buchard, 2005, eq A.19)</span>
            <span class="c1"># aM^2 (-d5 + n2 - (d3 - n1 + nb2 )Ri - (d4 + nb1)Ri^2) + aM (-d2 + n0 - (d1 + nb0)Ri) - d0 = 0</span>
            <span class="c1"># NOTE this is more robust method</span>
            <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d3</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb2</span><span class="p">)</span><span class="o">*</span><span class="n">ri_st</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span><span class="p">)</span><span class="o">*</span><span class="n">ri_st</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">)</span><span class="o">*</span><span class="n">ri_st</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span>
            <span class="n">a_shear</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span>

        <span class="k">return</span> <span class="n">a_shear</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.compute_c3_minus">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.compute_c3_minus">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_c3_minus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">ri_st</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute c3_minus parameter from c1 and c2 parameters.</span>

<span class="sd">        c3_minus is solved from equation</span>

<span class="sd">        .. math::</span>
<span class="sd">            Ri_{st} = \frac{s_m}{s_h} \frac{c2 - c1}{c2 - c3_{-}}</span>

<span class="sd">        where :math:`Ri_{st}` is the steady state gradient Richardson number.</span>
<span class="sd">        (see Burchard and Bolding, 2001, eq 32)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a_shear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_alpha_shear_steady</span><span class="p">(</span><span class="n">ri_st</span><span class="p">,</span> <span class="n">analytical</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># compute aN from Ri_st and aM, Ri_st = aN/aM</span>
        <span class="n">a_buoy</span> <span class="o">=</span> <span class="n">ri_st</span><span class="o">*</span><span class="n">a_shear</span>

        <span class="c1"># evaluate stability functions for equilibrium conditions</span>
        <span class="n">s_m</span><span class="p">,</span> <span class="n">s_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_funcs</span><span class="p">(</span><span class="n">a_buoy</span><span class="p">,</span> <span class="n">a_shear</span><span class="p">)</span>

        <span class="c1"># compute c3 minus from Umlauf and Burchard (2005)</span>
        <span class="n">c3_minus</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">-</span> <span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">c1</span><span class="p">)</span><span class="o">*</span><span class="n">s_m</span><span class="o">/</span><span class="n">s_h</span><span class="o">/</span><span class="n">ri_st</span>

        <span class="c1"># check error in ri_st</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">s_m</span><span class="o">/</span><span class="n">s_h</span><span class="o">*</span><span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">c1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">c3_minus</span><span class="p">)</span> <span class="o">-</span> <span class="n">ri_st</span>
        <span class="k">assert</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="s1">&#39;steady state gradient Richardson number does not match&#39;</span>

        <span class="k">return</span> <span class="n">c3_minus</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.compute_cmu0">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.compute_cmu0">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_cmu0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analytical</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute parameter :math:`c_\mu^0`</span>

<span class="sd">        See: Umlauf and Buchard (2005) eq A.22</span>

<span class="sd">        :kwarg bool analytical: If True (default), solve analytically using the</span>
<span class="sd">            coefficients of the stability function. Otherwise, solve</span>
<span class="sd">            :math:`\alpha_M` numerically from the equilibrium condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a_buoy</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">analytical</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d5</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d0</span>
            <span class="n">a_shear</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">a</span>
            <span class="n">s_m</span><span class="p">,</span> <span class="n">s_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_funcs</span><span class="p">(</span><span class="n">a_buoy</span><span class="p">,</span> <span class="n">a_shear</span><span class="p">)</span>
            <span class="n">cm0</span> <span class="o">=</span> <span class="n">s_m</span><span class="o">**</span><span class="mf">0.25</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">cost</span><span class="p">(</span><span class="n">a_shear</span><span class="p">):</span>
                <span class="n">s_m</span><span class="p">,</span> <span class="n">s_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_funcs</span><span class="p">(</span><span class="n">a_buoy</span><span class="p">,</span> <span class="n">a_shear</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">s_m</span><span class="o">*</span><span class="n">a_shear</span> <span class="o">-</span> <span class="mf">1.0</span>
                <span class="k">return</span> <span class="n">res</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="s1">&#39;solving alpha_shear failed&#39;</span>
            <span class="n">a_shear</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s_m</span><span class="p">,</span> <span class="n">s_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_funcs</span><span class="p">(</span><span class="n">a_buoy</span><span class="p">,</span> <span class="n">a_shear</span><span class="p">)</span>
            <span class="n">cm0</span> <span class="o">=</span> <span class="n">s_m</span><span class="o">**</span><span class="mf">0.25</span>
        <span class="k">return</span> <span class="n">cm0</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.compute_kappa">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.compute_kappa">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_kappa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma_psi</span><span class="p">,</span> <span class="n">cmu0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes von Karman constant from the Psi Schmidt number.</span>

<span class="sd">        See: Umlauf and Burchard (2003) eq (14)</span>

<span class="sd">        :arg sigma_psi: Psi Schmidt number</span>
<span class="sd">        :arg cmu0, n, c1, c2: GLS model parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cmu0</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_psi</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">c1</span><span class="p">))</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.compute_sigma_psi">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.compute_sigma_psi">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_sigma_psi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">cmu0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Psi Schmidt number from von Karman constant.</span>

<span class="sd">        See: Umlauf and Burchard (2003) eq (14)</span>

<span class="sd">        :arg kappa: von Karman constant</span>
<span class="sd">        :arg cmu0, n, c1, c2: GLS model parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">cmu0</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">c1</span><span class="p">))</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.compute_length_clim">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.compute_length_clim">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_length_clim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmu0</span><span class="p">,</span> <span class="n">ri_st</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Galpering length scale limit.</span>

<span class="sd">        :arg cmu0: parameter :math:`c_\mu^0`</span>
<span class="sd">        :arg ri_st: gradient Richardson number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a_shear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_alpha_shear_steady</span><span class="p">(</span><span class="n">ri_st</span><span class="p">)</span>

        <span class="c1"># compute aN from Ri_st and aM, Ri_st = aN/aM</span>
        <span class="n">a_buoy</span> <span class="o">=</span> <span class="n">ri_st</span><span class="o">*</span><span class="n">a_shear</span>

        <span class="n">clim</span> <span class="o">=</span> <span class="n">cmu0</span><span class="o">**</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a_buoy</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clim</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.get_alpha_buoy_min">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.get_alpha_buoy_min">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_alpha_buoy_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute minimum normalized buoyancy frequency :math:`\alpha_N`</span>

<span class="sd">        See: Umlauf and Buchard (2005), Table 3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># G = epsilon case, this is used in GOTM</span>
        <span class="n">an_min</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">-</span> <span class="mf">4.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span><span class="p">)</span>
        <span class="c1"># eq. (47)</span>
        <span class="c1"># an_min = self.alpha_buoy_min</span>
        <span class="k">return</span> <span class="n">an_min</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.get_alpha_shear_max">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.get_alpha_shear_max">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_alpha_shear_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute maximum normalized shear frequency :math:`\alpha_M`</span>

<span class="sd">        from Umlauf and Buchard (2005) eq (44)</span>

<span class="sd">        :arg alpha_buoy: normalized buoyancy frequency :math:`\alpha_N`</span>
<span class="sd">        :arg alpha_shear: normalized shear frequency :math:`\alpha_M`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">as_max_n</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span>
                    <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">)</span><span class="o">*</span><span class="n">alpha_buoy</span>
                    <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">)</span><span class="o">*</span><span class="n">alpha_buoy</span><span class="o">**</span><span class="mi">2</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="o">*</span><span class="n">alpha_buoy</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">as_max_d</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span>
                    <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span><span class="p">)</span><span class="o">*</span><span class="n">alpha_buoy</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="o">*</span><span class="n">alpha_buoy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">as_max_n</span><span class="o">/</span><span class="n">as_max_d</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.get_alpha_buoy_smooth_min">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.get_alpha_buoy_smooth_min">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_alpha_buoy_smooth_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_buoy</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute smoothed minimum for normalized buoyancy frequency</span>

<span class="sd">        See: Burchard and Petersen (1999), eq (19)</span>

<span class="sd">        :arg alpha_buoy: normalized buoyancy frequency :math:`\alpha_N`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">alpha_buoy</span> <span class="o">-</span> <span class="p">(</span><span class="n">alpha_buoy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_buoy_crit</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">alpha_buoy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alpha_buoy_min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_buoy_crit</span><span class="p">)</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.eval_funcs">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.eval_funcs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">eval_funcs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate (unlimited) stability functions</span>

<span class="sd">        See: Burchard and Petersen (1999) eqns (30) and (31)</span>

<span class="sd">        :arg alpha_buoy: normalized buoyancy frequency :math:`\alpha_N`</span>
<span class="sd">        :arg alpha_shear: normalized shear frequency :math:`\alpha_M`</span>
<span class="sd">        :returns: :math:`S_m`, :math:`S_\rho`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">den</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d1</span><span class="o">*</span><span class="n">alpha_buoy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d2</span><span class="o">*</span><span class="n">alpha_shear</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d3</span><span class="o">*</span><span class="n">alpha_buoy</span><span class="o">*</span><span class="n">alpha_shear</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d4</span><span class="o">*</span><span class="n">alpha_buoy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d5</span><span class="o">*</span><span class="n">alpha_shear</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c_mu</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n1</span><span class="o">*</span><span class="n">alpha_buoy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">n2</span><span class="o">*</span><span class="n">alpha_shear</span><span class="p">)</span> <span class="o">/</span> <span class="n">den</span>
        <span class="n">c_mu_p</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nb0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span><span class="o">*</span><span class="n">alpha_buoy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb2</span><span class="o">*</span><span class="n">alpha_shear</span><span class="p">)</span> <span class="o">/</span> <span class="n">den</span>
        <span class="k">return</span> <span class="n">c_mu</span><span class="p">,</span> <span class="n">c_mu_p</span></div>


<div class="viewcode-block" id="StabilityFunctionBase.evaluate">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionBase.evaluate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shear2</span><span class="p">,</span> <span class="n">buoy2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate stability functions from dimensional variables.</span>

<span class="sd">        Applies limiters on :math:`\alpha_N` and :math:`\alpha_M`.</span>

<span class="sd">        :arg shear2: shear frequency squared, :math:`M^2`</span>
<span class="sd">        :arg buoy2: buoyancy frequency squared,:math:`N^2`</span>
<span class="sd">        :arg k: turbulent kinetic energy, :math:`k`</span>
<span class="sd">        :arg eps: TKE dissipation rate, :math:`\varepsilon`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span> <span class="o">=</span> <span class="n">compute_normalized_frequencies</span><span class="p">(</span><span class="n">shear2</span><span class="p">,</span> <span class="n">buoy2</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lim_alpha_buoy</span><span class="p">:</span>
            <span class="c1"># limit min (negative) alpha_buoy (Umlauf and Burchard, 2005)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_alpha_buoy_lim</span><span class="p">:</span>
                <span class="c1"># crop at minimum value</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">alpha_buoy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alpha_buoy_min</span><span class="p">(),</span> <span class="n">alpha_buoy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># do smooth limiting instead (Buchard and Petersen, 1999, eq 19)</span>
                <span class="n">ab_smooth_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alpha_buoy_smooth_min</span><span class="p">(</span><span class="n">alpha_buoy</span><span class="p">)</span>
                <span class="c1"># NOTE this must be applied to values alpha_buoy &lt; ab_crit only!</span>
                <span class="n">ix</span> <span class="o">=</span> <span class="n">alpha_buoy</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_buoy_crit</span>
                <span class="n">alpha_buoy</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab_smooth_min</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lim_alpha_shear</span><span class="p">:</span>
            <span class="c1"># limit max alpha_shear (Umlauf and Burchard, 2005, eq 44)</span>
            <span class="n">as_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_alpha_shear_max</span><span class="p">(</span><span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="p">)</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">alpha_shear</span><span class="p">,</span> <span class="n">as_max</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_funcs</span><span class="p">(</span><span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="p">)</span></div>
</div>



<span class="k">class</span><span class="w"> </span><span class="nc">GOTMStabilityFunctionBase</span><span class="p">(</span><span class="n">StabilityFunctionBase</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for stability functions defined in Umlauf and Buchard (2005)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cc1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cc2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cc3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cc4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cc5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cc6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cb1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cb2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cb3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cb4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cb5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cbb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lim_alpha_shear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lim_alpha_buoy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">smooth_alpha_buoy_lim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha_buoy_crit</span><span class="o">=-</span><span class="mf">1.2</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :kwarg bool lim_alpha_shear: limit maximum :math:`\alpha_M` values</span>
<span class="sd">            (see Umlauf and Burchard (2005) eq. 44)</span>
<span class="sd">        :kwarg bool lim_alpha_buoy: limit minimum (negative) :math:`\alpha_N` values</span>
<span class="sd">            (see Umlauf and Burchard (2005))</span>
<span class="sd">        :kwarg bool smooth_alpha_buoy_lim: if :math:`\alpha_N` is limited, apply a</span>
<span class="sd">            smooth limiter (see Burchard and Bolding (2001) eq. 19). Otherwise</span>
<span class="sd">            :math:`\alpha_N` is clipped at minimum value.</span>
<span class="sd">        :kwarg float alpha_buoy_crit: parameter for :math:`\alpha_N` smooth limiter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lim_alpha_shear</span><span class="p">,</span> <span class="n">lim_alpha_buoy</span><span class="p">,</span>
                         <span class="n">smooth_alpha_buoy_lim</span><span class="p">,</span> <span class="n">alpha_buoy_crit</span><span class="p">)</span>

        <span class="c1"># Umlauf and Buchard (2005) eq A.10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cc2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cc3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a3</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cc4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a4</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cc5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a5</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cc6</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ab1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ab2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ab3</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ab4</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ab5</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cbb</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb5</span><span class="p">)</span>

        <span class="c1"># Umlauf and Buchard (2005) eq A.12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cc1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb1</span>

        <span class="c1"># Umlauf and Buchard (2005) eq A.9</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d0</span> <span class="o">=</span> <span class="mf">36.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="mf">84.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span> <span class="o">+</span> <span class="mf">36.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="mf">9.0</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ab2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">12.0</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d3</span> <span class="o">=</span> <span class="mf">12.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab1</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">+</span>\
            <span class="mf">12.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span> <span class="o">+</span>\
            <span class="mf">12.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab5</span><span class="o">*</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d4</span> <span class="o">=</span> <span class="mf">48.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">+</span> <span class="mf">36.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d5</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ab1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="mf">36.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">12.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ab1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
            <span class="mf">8.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span> <span class="o">+</span>\
            <span class="mf">36.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">=</span> <span class="mf">9.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ab2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span> <span class="o">=</span> <span class="mf">12.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span> <span class="o">=</span> <span class="mf">12.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb2</span> <span class="o">=</span> <span class="mf">9.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ab1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ab2</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>\
            <span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">)</span> <span class="o">-</span> <span class="mf">4.0</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ab3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb</span>


<span class="k">class</span><span class="w"> </span><span class="nc">CanutoStabilityFunctionBase</span><span class="p">(</span><span class="n">StabilityFunctionBase</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for original Canuto stability function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lim_alpha_shear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lim_alpha_buoy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">smooth_alpha_buoy_lim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha_buoy_crit</span><span class="o">=-</span><span class="mf">1.2</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :kwarg bool lim_alpha_shear: limit maximum :math:`\alpha_M` values</span>
<span class="sd">            (see Umlauf and Burchard (2005) eq. 44)</span>
<span class="sd">        :kwarg bool lim_alpha_buoy: limit minimum (negative) :math:`\alpha_N` values</span>
<span class="sd">            (see Umlauf and Burchard (2005))</span>
<span class="sd">        :kwarg bool smooth_alpha_buoy_lim: if :math:`\alpha_N` is limited, apply a</span>
<span class="sd">            smooth limiter (see Burchard and Bolding (2001) eq. 19). Otherwise</span>
<span class="sd">            :math:`\alpha_N` is clipped at minimum value.</span>
<span class="sd">        :kwarg float alpha_buoy_crit: parameter for :math:`\alpha_N` smooth limiter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lim_alpha_shear</span><span class="p">,</span> <span class="n">lim_alpha_buoy</span><span class="p">,</span>
                         <span class="n">smooth_alpha_buoy_lim</span><span class="p">,</span> <span class="n">alpha_buoy_crit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">s0</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mi">8</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s4</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s5</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s6</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.75</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dd0</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.75</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd5</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l7</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l8</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># unit conversion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s6</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">eval_funcs_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate (unlimited) stability functions</span>

<span class="sd">        From Canuto et al (2001)</span>

<span class="sd">        :arg alpha_buoy: normalized buoyancy frequency :math:`\alpha_N`</span>
<span class="sd">        :arg alpha_shear: normalized shear frequency :math:`\alpha_M`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tN2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="n">alpha_buoy</span>
        <span class="n">tS2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="n">alpha_shear</span>
        <span class="n">dsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="o">*</span><span class="n">tN2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="o">*</span><span class="n">tS2</span>
        <span class="n">dsh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s5</span><span class="o">*</span><span class="n">tN2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s6</span><span class="o">*</span><span class="n">tS2</span>
        <span class="n">den</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd1</span><span class="o">*</span><span class="n">tN2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd2</span><span class="o">*</span><span class="n">tS2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd3</span><span class="o">*</span><span class="n">tN2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd4</span><span class="o">*</span><span class="n">tN2</span><span class="o">*</span><span class="n">tS2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd5</span><span class="o">*</span><span class="n">tS2</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="n">dsm</span><span class="o">/</span><span class="n">den</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="n">dsh</span><span class="o">/</span><span class="n">den</span>
        <span class="k">return</span> <span class="n">sm</span><span class="p">,</span> <span class="n">sh</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ChengStabilityFunctionBase</span><span class="p">(</span><span class="n">StabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for original Cheng stability function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">l8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lim_alpha_shear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lim_alpha_buoy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">smooth_alpha_buoy_lim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha_buoy_crit</span><span class="o">=-</span><span class="mf">1.2</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :kwarg bool lim_alpha_shear: limit maximum :math:`\alpha_M` values</span>
<span class="sd">            (see Umlauf and Burchard (2005) eq. 44)</span>
<span class="sd">        :kwarg bool lim_alpha_buoy: limit minimum (negative) :math:`\alpha_N` values</span>
<span class="sd">            (see Umlauf and Burchard (2005))</span>
<span class="sd">        :kwarg bool smooth_alpha_buoy_lim: if :math:`\alpha_N` is limited, apply a</span>
<span class="sd">            smooth limiter (see Burchard and Bolding (2001) eq. 19). Otherwise</span>
<span class="sd">            :math:`\alpha_N` is clipped at minimum value.</span>
<span class="sd">        :kwarg float alpha_buoy_crit: parameter for :math:`\alpha_N` smooth limiter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lim_alpha_shear</span><span class="p">,</span> <span class="n">lim_alpha_buoy</span><span class="p">,</span>
                         <span class="n">smooth_alpha_buoy_lim</span><span class="p">,</span> <span class="n">alpha_buoy_crit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">s0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">8</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s4</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s5</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**-</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s6</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dd0</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">7.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l8</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.25</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd3</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd4</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l7</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">l8</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dd5</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l5</span><span class="o">**-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l3</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">l7</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># unit conversion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dd5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">s6</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">eval_funcs_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_buoy</span><span class="p">,</span> <span class="n">alpha_shear</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate (unlimited) stability functions</span>

<span class="sd">        From Canuto et al (2001)</span>

<span class="sd">        :arg alpha_buoy: normalized buoyancy frequency :math:`\alpha_N`</span>
<span class="sd">        :arg alpha_shear: normalized shear frequency :math:`\alpha_M`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tN2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="n">alpha_buoy</span>
        <span class="n">tS2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_scalar</span><span class="o">*</span><span class="n">alpha_shear</span>
        <span class="n">dsm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="o">*</span><span class="n">tN2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="o">*</span><span class="n">tS2</span>
        <span class="n">dsh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s5</span><span class="o">*</span><span class="n">tN2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s6</span><span class="o">*</span><span class="n">tS2</span>
        <span class="n">den</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd1</span><span class="o">*</span><span class="n">tN2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd2</span><span class="o">*</span><span class="n">tS2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd3</span><span class="o">*</span><span class="n">tN2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd4</span><span class="o">*</span><span class="n">tN2</span><span class="o">*</span><span class="n">tS2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dd5</span><span class="o">*</span><span class="n">tS2</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="n">dsm</span><span class="o">/</span><span class="n">den</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cu_scalar</span><span class="o">*</span><span class="n">dsh</span><span class="o">/</span><span class="n">den</span>
        <span class="k">return</span> <span class="n">sm</span><span class="p">,</span> <span class="n">sh</span>


<div class="viewcode-block" id="StabilityFunctionCanutoA">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionCanutoA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StabilityFunctionCanutoA</span><span class="p">(</span><span class="n">CanutoStabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Canuto A stability function as defined in the Canuto (2001) paper.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="mf">0.107</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="mf">0.0032</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="mf">0.0864</span>
    <span class="n">l4</span> <span class="o">=</span> <span class="mf">0.12</span>
    <span class="n">l5</span> <span class="o">=</span> <span class="mf">11.9</span>
    <span class="n">l6</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">l7</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">l8</span> <span class="o">=</span> <span class="mf">0.48</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Canuto A&#39;</span></div>



<div class="viewcode-block" id="StabilityFunctionCanutoB">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionCanutoB">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StabilityFunctionCanutoB</span><span class="p">(</span><span class="n">CanutoStabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Canuto B stability function as defined in the Canuto (2001) paper.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="mf">0.127</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="mf">0.00336</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="mf">0.0906</span>
    <span class="n">l4</span> <span class="o">=</span> <span class="mf">0.101</span>
    <span class="n">l5</span> <span class="o">=</span> <span class="mf">11.2</span>
    <span class="n">l6</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">l7</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">l8</span> <span class="o">=</span> <span class="mf">0.318</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Canuto B&#39;</span></div>



<div class="viewcode-block" id="StabilityFunctionCheng">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.StabilityFunctionCheng">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StabilityFunctionCheng</span><span class="p">(</span><span class="n">ChengStabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cheng stability function as defined in the Cheng et al (2002) paper.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="mf">0.107</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="mf">0.0032</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="mf">0.0864</span>
    <span class="n">l4</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">l5</span> <span class="o">=</span> <span class="mf">11.04</span>
    <span class="n">l6</span> <span class="o">=</span> <span class="mf">0.786</span>
    <span class="n">l7</span> <span class="o">=</span> <span class="mf">0.643</span>
    <span class="n">l8</span> <span class="o">=</span> <span class="mf">0.547</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Cheng&#39;</span></div>



<div class="viewcode-block" id="GOTMStabilityFunctionCanutoA">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.GOTMStabilityFunctionCanutoA">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GOTMStabilityFunctionCanutoA</span><span class="p">(</span><span class="n">GOTMStabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Canuto et al. (2001) version A stability functions</span>

<span class="sd">    Parameters are from Umlauf and Buchard (2005), Table 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cc1</span> <span class="o">=</span> <span class="mf">5.0000</span>
    <span class="n">cc2</span> <span class="o">=</span> <span class="mf">0.8000</span>
    <span class="n">cc3</span> <span class="o">=</span> <span class="mf">1.9680</span>
    <span class="n">cc4</span> <span class="o">=</span> <span class="mf">1.1360</span>
    <span class="n">cc5</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cc6</span> <span class="o">=</span> <span class="mf">0.4000</span>
    <span class="n">cb1</span> <span class="o">=</span> <span class="mf">5.9500</span>
    <span class="n">cb2</span> <span class="o">=</span> <span class="mf">0.6000</span>
    <span class="n">cb3</span> <span class="o">=</span> <span class="mf">1.0000</span>
    <span class="n">cb4</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cb5</span> <span class="o">=</span> <span class="mf">0.3333</span>
    <span class="n">cbb</span> <span class="o">=</span> <span class="mf">0.7200</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Canuto A&#39;</span></div>



<div class="viewcode-block" id="GOTMStabilityFunctionCanutoB">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.GOTMStabilityFunctionCanutoB">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GOTMStabilityFunctionCanutoB</span><span class="p">(</span><span class="n">GOTMStabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Canuto et al. (2001) version B stability functions</span>

<span class="sd">    Parameters are from Umlauf and Buchard (2005), Table 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cc1</span> <span class="o">=</span> <span class="mf">5.0000</span>
    <span class="n">cc2</span> <span class="o">=</span> <span class="mf">0.6983</span>
    <span class="n">cc3</span> <span class="o">=</span> <span class="mf">1.9664</span>
    <span class="n">cc4</span> <span class="o">=</span> <span class="mf">1.0940</span>
    <span class="n">cc5</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cc6</span> <span class="o">=</span> <span class="mf">0.4950</span>
    <span class="n">cb1</span> <span class="o">=</span> <span class="mf">5.6000</span>
    <span class="n">cb2</span> <span class="o">=</span> <span class="mf">0.6000</span>
    <span class="n">cb3</span> <span class="o">=</span> <span class="mf">1.0000</span>
    <span class="n">cb4</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cb5</span> <span class="o">=</span> <span class="mf">0.3333</span>
    <span class="n">cbb</span> <span class="o">=</span> <span class="mf">0.4770</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Canuto B&#39;</span></div>



<div class="viewcode-block" id="GOTMStabilityFunctionKanthaClayson">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.GOTMStabilityFunctionKanthaClayson">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GOTMStabilityFunctionKanthaClayson</span><span class="p">(</span><span class="n">GOTMStabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kantha and Clayson (1994) quasi-equilibrium stability functions</span>

<span class="sd">    Parameters are from Umlauf and Buchard (2005), Table 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cc1</span> <span class="o">=</span> <span class="mf">6.0000</span>
    <span class="n">cc2</span> <span class="o">=</span> <span class="mf">0.3200</span>
    <span class="n">cc3</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cc4</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cc5</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cc6</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cb1</span> <span class="o">=</span> <span class="mf">3.7280</span>
    <span class="n">cb2</span> <span class="o">=</span> <span class="mf">0.7000</span>
    <span class="n">cb3</span> <span class="o">=</span> <span class="mf">0.7000</span>
    <span class="n">cb4</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cb5</span> <span class="o">=</span> <span class="mf">0.2000</span>
    <span class="n">cbb</span> <span class="o">=</span> <span class="mf">0.6102</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Kantha Clayson&#39;</span></div>



<div class="viewcode-block" id="GOTMStabilityFunctionCheng">
<a class="viewcode-back" href="../../thetis.html#thetis.stability_functions.GOTMStabilityFunctionCheng">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GOTMStabilityFunctionCheng</span><span class="p">(</span><span class="n">GOTMStabilityFunctionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cheng et al. (2002) quasi-equilibrium stability functions</span>

<span class="sd">    Parameters are from Umlauf and Buchard (2005), Table 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cc1</span> <span class="o">=</span> <span class="mf">5.0000</span>
    <span class="n">cc2</span> <span class="o">=</span> <span class="mf">0.7983</span>
    <span class="n">cc3</span> <span class="o">=</span> <span class="mf">1.9680</span>
    <span class="n">cc4</span> <span class="o">=</span> <span class="mf">1.1360</span>
    <span class="n">cc5</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cc6</span> <span class="o">=</span> <span class="mf">0.5000</span>
    <span class="n">cb1</span> <span class="o">=</span> <span class="mf">5.5200</span>
    <span class="n">cb2</span> <span class="o">=</span> <span class="mf">0.2134</span>
    <span class="n">cb3</span> <span class="o">=</span> <span class="mf">0.3570</span>
    <span class="n">cb4</span> <span class="o">=</span> <span class="mf">0.0000</span>
    <span class="n">cb5</span> <span class="o">=</span> <span class="mf">0.3333</span>
    <span class="n">cbb</span> <span class="o">=</span> <span class="mf">0.8200</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Cheng&#39;</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
    </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2016-2025, Tuomas Kärnä et al..
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>